---
import Layout from "./Layout.astro";
import { formatDate } from "../utils/date";
import BlogSearch from "../components/blog/BlogSearch";

interface BlogPost {
  slug: string;
  data: {
    title: string;
    description: string;
    created_at: Date;
    image?: string;
    category: string;
    tags: string[];
    author: {
      name: string;
      image: string;
    };
  };
}

interface Props {
  title: string;
  description: string;
  lang: string;
  posts: BlogPost[];
  categories?: { name: string; count: number }[];
  currentCategory?: string;
  pagination: {
    currentPage: number;
    totalPages: number;
    url: {
      prev?: string;
      next?: string;
    };
  };
}

const {
  title,
  description,
  lang,
  posts,
  categories,
  currentCategory,
  pagination,
} = Astro.props;

const baseUrl = `/${lang === "en" ? "" : "id/"}blog`;
---

<Layout title={title} description={description} lang={lang}>
  <div class="mx-auto max-w-6xl px-4 py-12 sm:px-6 lg:px-8">
    <main class="prose prose-lg max-w-none">
      <div class="not-prose flex flex-col gap-12 lg:flex-row">
        <!-- Main Content -->
        <div class="flex-1">
          <header>
            <h1>{title}</h1>
            <p class="lead">{description}</p>
          </header>

          <!-- Search and Posts -->
          <BlogSearch posts={posts} lang={lang} baseUrl={baseUrl} client:load />

          <!-- Pagination -->
          {
            pagination.totalPages > 1 && (
              <div class="mt-12 flex justify-center gap-2">
                {pagination.url.prev && (
                  <a href={pagination.url.prev} class="btn btn-ghost">
                    ← {lang === "en" ? "Previous" : "Sebelumnya"}
                  </a>
                )}
                <span class="btn btn-ghost">
                  {pagination.currentPage} / {pagination.totalPages}
                </span>
                {pagination.url.next && (
                  <a href={pagination.url.next} class="btn btn-ghost">
                    {lang === "en" ? "Next" : "Selanjutnya"} →
                  </a>
                )}
              </div>
            )
          }
        </div>

        <!-- Sidebar -->
        <aside class="space-y-8 lg:w-72">
          <!-- Categories -->
          {
            categories && (
              <div class="bg-base-200 rounded-xl p-6">
                <h2 class="!mt-0 !mb-4">
                  {lang === "en" ? "Categories" : "Kategori"}
                </h2>
                <ul class="!mt-0 space-y-2">
                  <li>
                    <a
                      href={baseUrl}
                      class={`hover:text-primary block transition-colors ${!currentCategory ? "text-primary" : ""}`}
                    >
                      {lang === "en" ? "All Posts" : "Semua Artikel"}
                    </a>
                  </li>
                  {categories.map((category) => (
                    <li>
                      <a
                        href={`${baseUrl}/${category.name}`}
                        class={`hover:text-primary block transition-colors ${currentCategory === category.name ? "text-primary" : ""}`}
                      >
                        {category.name}
                        <span> ({category.count})</span>
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            )
          }
        </aside>
      </div>
    </main>
  </div>
</Layout>
