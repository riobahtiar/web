---
import Layout from "./Layout.astro";
import { formatDate } from "../utils/date";
import { Icon } from "astro-icon/components";
import TableOfContents from "../components/blog/TableOfContents.astro";

interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  title: string;
  description: string;
  created_at: Date;
  modified_at: Date;
  image?: string;
  category: string;
  tags: string[];
  lang: "en" | "id";
  readingTime?: string;
  headings?: Heading[];
  author: {
    name: string;
    image: string;
    bio: string;
  };
}

const {
  title,
  description,
  created_at,
  modified_at,
  image,
  category,
  tags,
  lang,
  readingTime,
  headings = [],
  author,
} = Astro.props;

const formattedDate = formatDate(created_at, lang);
const formattedModifiedDate = formatDate(modified_at, lang);
---

<Layout
  title={`${title} | Rio Bahtiar`}
  description={description}
  lang={lang}
  image={image}
  type="article"
  publishedTime={created_at.toISOString()}
  modifiedTime={modified_at.toISOString()}
  author={author.name}
  tags={tags}
  readingTime={readingTime}
>
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="grid grid-cols-1 gap-8 lg:grid-cols-[1fr_250px]">
      <!-- Main Content -->
      <article class="prose prose-lg max-w-none lg:max-w-4xl">
        <!-- Article Header -->
        <header>
          <div
            class="text-base-content/70 mb-4 flex items-center gap-3 text-sm"
          >
            <a
              href={`/${lang === "en" ? "" : "id/"}blog/${category}`}
              class="hover:text-primary capitalize transition-colors"
            >
              {category}
            </a>
            <span>•</span>
            <time datetime={created_at.toISOString()}>{formattedDate}</time>
            {
              readingTime && (
                <>
                  <span>•</span>
                  <span class="flex items-center gap-1">
                    <Icon name="tabler:clock" class="h-4 w-4" />
                    {readingTime}
                  </span>
                </>
              )
            }
          </div>

          <h1>{title}</h1>

          <p class="lead">{description}</p>

          <!-- Author Info -->
          <div class="not-prose flex items-center gap-4">
            <img
              src={author.image}
              alt={author.name}
              width="48"
              height="48"
              class="rounded-full"
            />
            <div>
              <div class="font-medium">{author.name}</div>
              <div class="text-sm">{author.bio}</div>
            </div>
          </div>

          {
            image && (
              <div class="not-prose relative aspect-[2/1]">
                <img
                  src={image}
                  alt={title}
                  class="rounded-xl object-cover"
                  width="1200"
                  height="600"
                />
              </div>
            )
          }
        </header>

        <slot />

        <!-- Article Footer -->
        <footer class="not-prose border-base-200 mt-12 border-t pt-8">
          <div class="mb-6 flex flex-wrap gap-2">
            {
              tags.map((tag) => (
                <a
                  href={`/${lang === "en" ? "" : "id/"}blog/tag/${tag}`}
                  class="bg-base-200 hover:bg-base-300 rounded-full px-3 py-1 text-sm transition-colors"
                >
                  #{tag}
                </a>
              ))
            }
          </div>

          {
            modified_at > created_at && (
              <p class="text-sm">
                {lang === "en" ? "Last updated: " : "Terakhir diperbarui: "}
                <time datetime={modified_at.toISOString()}>
                  {formattedModifiedDate}
                </time>
              </p>
            )
          }
        </footer>
      </article>

      <!-- Table of Contents Sidebar -->
      <TableOfContents headings={headings} lang={lang} />
    </div>
  </div>
</Layout>
