---
import { Icon } from "astro-icon/components";

interface Props {
  lang: string;
}

const { lang } = Astro.props;
const message =
  lang === "en"
    ? "ðŸš§ This site is currently under construction. Some features might not work as expected."
    : "ðŸš§ Situs ini sedang dalam pengembangan. Beberapa fitur mungkin belum berfungsi dengan baik.";
---

<div
  id="announcement-banner"
  class="bg-primary/10 px-4 py-1.5 transition-all duration-300"
  role="alert"
>
  <div class="mx-auto flex items-center justify-between gap-4">
    <div class="relative min-h-[1.5rem] flex-1 overflow-hidden">
      <div
        id="marquee-content"
        class="text-primary-content/90 absolute right-0 left-0 text-sm font-medium whitespace-nowrap"
      >
        <span>{message}</span>
      </div>
    </div>
    <button
      type="button"
      class="text-primary hover:bg-primary/20 focus:ring-primary inline-flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-lg focus:ring-2 focus:outline-none"
      aria-label="Close"
      onclick="hideBanner()"
    >
      <Icon name="tabler:close" class="h-4 w-4" />
    </button>
  </div>
</div>

<style>
  @keyframes slide {
    0% {
      transform: translateX(100%);
    }
    100% {
      transform: translateX(-100%);
    }
  }

  #marquee-content {
    animation: slide 10s linear infinite;
    transform: translateX(100%);
  }

  #announcement-banner {
    min-height: 2.5rem;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  /* Ensure banner is hidden when JavaScript is disabled */
  .no-js #announcement-banner {
    display: none;
  }
</style>

<script>
  function hideBanner() {
    const banner = document.getElementById("announcement-banner");
    if (!banner) return;

    banner.style.height = "0";
    banner.style.opacity = "0";
    banner.style.overflow = "hidden";
    banner.style.padding = "0";
    banner.style.margin = "0";
    localStorage.setItem("hideBanner", "true");

    setTimeout(() => {
      banner.style.display = "none";
    }, 300);
  }

  document.addEventListener("astro:page-load", () => {
    const banner = document.getElementById("announcement-banner");
    if (!banner) return;

    if (localStorage.getItem("hideBanner") === "true") {
      banner.style.display = "none";
      return;
    }

    banner.style.display = "block";
  });
</script>
